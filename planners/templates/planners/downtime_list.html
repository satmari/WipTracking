{% extends 'core/base.html' %}
{% load static %}

{% block title %}Downtime List{% endblock %}

{% block content %}
<div class="container-fluid mt-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4 mb-0">Downtime List</h1>
    <a href="{% url 'planners:downtime_add' %}" class="btn btn-primary btn-sm">
      Add Downtime
    </a>
  </div>

  <div class="card shadow-sm">
    <div class="card-body p-0">

      <table id="downtime-table"
             class="table table-striped table-hover mb-0 auto-init-filters"
             style="width:100%;">

        <thead class="table-light">
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Subdepartment</th>
            <th>Fixed</th>
            <th>Value (min)</th>
            <th class="text-end">Actions</th>
          </tr>

          <!-- FILTER ROW -->
          <tr>
            <th><input class="form-control form-control-sm column-filter" data-column="0"></th>
            <th><input class="form-control form-control-sm column-filter" data-column="1"></th>
            <th><input class="form-control form-control-sm column-filter" data-column="2"></th>
            <th><input class="form-control form-control-sm column-filter" data-column="3"></th>
            <th><input class="form-control form-control-sm column-filter" data-column="4"></th>
            <th></th>
          </tr>
        </thead>

        <tbody>
          {% for d in downtimes %}
          <tr>
            <td>{{ d.id }}</td>
            <td>{{ d.downtime_name }}</td>
            <td>{{ d.subdepartment }}</td>
            <td>
              {% if d.fixed_duration %}
                Yes
              {% else %}
                No
              {% endif %}
            </td>
            <td>{{ d.downtime_value|default:"-" }}</td>
            <td class="text-end">
              <a href="{% url 'planners:downtime_edit' d.pk %}"
                 class="btn btn-sm btn-outline-primary">
                Edit
              </a>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-muted text-center py-3">
              No downtimes defined.
            </td>
          </tr>
          {% endfor %}
        </tbody>

      </table>

    </div>
  </div>

</div>
{% endblock %}

{% block scripts %}
{{ block.super }}
<script>
  $(function(){
    initTableWithColumnFilters('#downtime-table', {
      order: [[0, 'desc']],
      pageLength: 25,
      columnDefs: [{ orderable: false, targets: -1 }]
    });
  });
</script>
{% endblock %}
