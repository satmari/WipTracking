{% extends 'core/base.html' %}
{% load static %}

{% block title %}Operator Breaks{% endblock %}

{% block content %}
<div class="container-fluid mt-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h4 mb-0">Operator Breaks</h1>

    <div class="btn-group">
      <a href="{% url 'planners:operator_break_declare' %}"
         class="btn btn-primary btn-sm">
        + Declare break
      </a>
    </div>
  </div>

  <div class="card shadow-sm">
    <div class="card-body p-0">

      <table id="operator-break-table"
             class="table table-striped table-hover mb-0 auto-init-filters"
             style="width:100%;">

        <thead class="table-light">
          <tr>
            <th>ID</th>
            <th>Date</th>
            <th>Team user</th>
            <th>Operator</th>
            <th>Break</th>
            <th>Break start</th>
            <th>Break end</th>
            <th>Created</th>
            <th>Updated</th>
            <th class="text-end" style="width:140px;">Actions</th>
          </tr>

          {# FILTER ROW #}
          <tr>
            <th><input class="form-control form-control-sm column-filter" data-column="0" placeholder="Filter…"></th>
            <th><input class="form-control form-control-sm column-filter" data-column="1" placeholder="d.m.Y"></th>
            <th><input class="form-control form-control-sm column-filter" data-column="2" placeholder="Team"></th>
            <th><input class="form-control form-control-sm column-filter" data-column="3" placeholder="Operator"></th>
            <th><input class="form-control form-control-sm column-filter" data-column="4" placeholder="Break"></th>
            <th><input class="form-control form-control-sm column-filter" data-column="5" placeholder="HH:MM"></th>
            <th><input class="form-control form-control-sm column-filter" data-column="6" placeholder="HH:MM"></th>
            <th><input class="form-control form-control-sm column-filter" data-column="7" placeholder="Created"></th>
            <th><input class="form-control form-control-sm column-filter" data-column="8" placeholder="Updated"></th>
            <th></th>
          </tr>
        </thead>

        <tbody>
          {% for ob in operator_breaks %}
          <tr>
            <td>{{ ob.id }}</td>
            <td>{{ ob.date|date:"d.m.Y." }}</td>

            <td>
              {% if ob.team_user %}
                {{ ob.team_user.username }}
              {% else %}
                <span class="text-muted">—</span>
              {% endif %}
            </td>

            <td>
              {{ ob.operator.badge_num }} — {{ ob.operator.name }}
            </td>

            <td>
              {{ ob.break_type.break_name }}
            </td>

            <td>
              {{ ob.break_type.break_time_start|time:"H:i" }}
            </td>

            <td>
              {{ ob.break_type.break_time_end|time:"H:i" }}
            </td>

            <td>{{ ob.created_at|date:"d.m.Y. H:i" }}</td>
            <td>{{ ob.updated_at|date:"d.m.Y. H:i" }}</td>

            <td class="text-end">
              <a href="{% url 'planners:operator_break_edit' ob.pk %}"
                 class="btn btn-sm btn-outline-secondary me-1">
                Edit
              </a>

              <a href="{% url 'planners:operator_break_delete' ob.pk %}"
                 class="btn btn-sm btn-outline-danger">
                Delete
              </a>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="10" class="text-center text-muted py-4">
              No operator breaks found.
            </td>
          </tr>
          {% endfor %}
        </tbody>

      </table>
    </div>
  </div>

</div>
{% endblock %}

{% block scripts %}
{{ block.super }}

<style>
  .column-filter {
    min-width: 60px;
    max-width: 200px;
    font-size: .85rem;
    padding: 2px 4px;
  }
</style>

<script>
  $(function(){
    window.initTableWithColumnFilters('#operator-break-table', {
      pageLength: 25,
      lengthMenu: [10, 25, 50, 100],
      order: [[0, 'desc']],
      columnDefs: [
        { orderable: false, targets: -1 }
      ]
    });
  });
</script>

{% endblock %}
